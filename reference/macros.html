<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>Clojure - Macros(マクロ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Clojure の日本語ドキュメントです">
    <meta name="author" content="Japan Clojurians">
    <meta name="keywords" content="Clojure 日本語">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/normalize.css" rel="stylesheet">
    <link href="../css/webflow.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" type="image/x-icon" href="../images/clojure-logo-icon-32.png">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">Clojure</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../about/rationale.html">概要</a></li>
            <li><a href="../reference/documentation">リファレンス</a></li>
            <!-- <li><a href="../api/api.html">API</a></li>
              <li><a href="../community/downloads.html">リリース</a></li>
              <li><a href="../guides/guides.html">ガイド</a></li>
              <li><a href="../community/resources.html">コミュニティ</a></li>
              <li><a href="../news/news.html">ニュース</a></li>
              <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Nav header</li>
              <li><a href="#">Separated link</a></li>
              <li><a href="#">One more separated link</a></li>
              </ul>
              </li> -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

<div class="page-header">
  <h1>Macros(マクロ)</h1>
</div>

<p><em></em></p>

<p><div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_特殊な変数">特殊な変数</a></li>
</ul>
</div>
<div class="paragraph">
<p>Clojureにはプログラマティカルなマクロシステムがあり、ユーザーコードによるコンパイラの拡張を可能にする。マクロを使用することで、他の言語ではプリミティヴや組み込みサポートが必要になる文法構造を定義することができる。実際、Clojureのコアな文法構造はプリミティヴではなく、通常のマクロである。</p>
</div>
<div class="paragraph">
<p>いくつかのマクロは単純なプリミティヴフォームの組み合わせを作り出す。例えば
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when"><code>when</code></a>
は <a href="special_forms#if"><code>if</code></a> と <a href="special_forms#do"><code>do</code></a> を組み合わせる:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure-repl" data-lang="clojure-repl">user=&gt; (macroexpand '(when (pos? a) (println "positive") (/ b a)))
(if (pos? a) (do (println "positive") (/ b a)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>いくつかのマクロは再帰的に式を次の式の第1引数として挿入する <code>-></code> マクロのようにフォームを便利な形に並べ替える:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure-repl" data-lang="clojure-repl">user=&gt; (-&gt; {} (assoc :a 1) (assoc :b 2))
{:b 2, :a 1}
user=&gt; (macroexpand '(-&gt; {} (assoc :a 1) (assoc :b 2)))
(assoc (clojure.core/-&gt; {} (assoc :a 1)) :b 2)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_特殊な変数">特殊な変数</h2>
<div class="sectionbody">
<div class="paragraph">
<p>高度な用法のために、defmacroの中で使用可能な特別な変数が2つある:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;form</code> - 呼び出される(データとしての)実際のフォーム</p>
</li>
<li>
<p><code>&amp;env</code> -
マクロ展開の時点でのローカル束縛のマップ。envマップはシンボルからオブジェクトへのマップであり、その束縛についてのコンパイラ情報を持つ。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下のマクロは全て the <a href="http://clojure.github.io/clojure/">API</a>
にドキュメント化されている。多くは記載のようにトピックページでも扱われている:</p>
</div>
<div class="paragraph">
<p>マクロを作成する:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmacro">defmacro</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/definline">definline</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/macroexpand-1">macroexpand-1</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/macroexpand">macroexpand</a><br>
分岐:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/and">and</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/or">or</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when">when</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-not">when-not</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-let">when-let</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-first">when-first</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/if-not">if-not</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/if-let">if-let</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/cond">cond</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/condp">condp</a><br>
ループ ( <a href="sequences">Sequences</a> も参照):<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/for">for</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doseq">doseq</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/dotimes">dotimes</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/while">while</a><br>
varを扱う ( <a href="vars">Vars and Environment</a> も参照):<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/ns">ns</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/declare">declare</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defn">defn</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmacro">defmacro</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/definline">definline</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmethod">defmethod</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmulti">defmulti</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defn-">defn-</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defonce">defonce</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defstruct">defstruct</a><br>
コードの並べ替え:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/%2E%2E">..</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doto">doto</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/-%3e">-></a><br>
ダイナミックスコープ ( <a href="vars">Vars and Environment</a> も参照):<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/binding">binding</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/locking">locking</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/time">time</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-in-str">with-in-str</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-local-vars">with-local-vars</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-open">with-open</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-out-str">with-out-str</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-precision">with-precision</a><br>
lazyなものを作成する ( <a href="sequences">Sequences</a> も参照):<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/lazy-cat">lazy-cat</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/lazy-cons">lazy-cons</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/delay">delay</a><br>
<a href="java_interop">Java interop</a> macros:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/%2E%2E">..</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/amap">amap</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/areduce">areduce</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/gen-class">gen-class</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/gen-interface">gen-interface</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/proxy">proxy</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/proxy-super">proxy-super</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/memfn">memfn</a><br>
コードをドキュメント化する:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/assert">assert</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/comment">comment</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doc">doc</a><br>
トランザクション:<br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/dosync">dosync</a><br>
<a href="http://clojure.github.io/clojure/clojure.core-api.html#clojure.core/io!">io!</a></p>
</div>
<div class="paragraph">
<p>いくつかの <a href="special_forms">special forms</a> は実際には主に分配束縛を提供する目的でマクロとして実装されている: fn
let loop</p>
</div>
</div>
</div></p>

<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/prettify.js"></script>

  </body>
</html>