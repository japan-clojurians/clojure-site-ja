<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>Clojure - Macros</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Clojure の日本語ドキュメントです">
    <meta name="author" content="Japan Clojurians">
    <meta name="keywords" content="Clojure 日本語">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/normalize.css" rel="stylesheet">
    <link href="../css/webflow.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" type="image/x-icon" href="../images/clojure-logo-icon-32.png">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">Clojure</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../about/rationale.html">概要</a></li>
            <li><a href="../reference/documentation">リファレンス</a></li>
            <!-- <li><a href="../api/api.html">API</a></li>
              <li><a href="../community/downloads.html">リリース</a></li>
              <li><a href="../guides/guides.html">ガイド</a></li>
              <li><a href="../community/resources.html">コミュニティ</a></li>
              <li><a href="../news/news.html">ニュース</a></li>
              <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Nav header</li>
              <li><a href="#">Separated link</a></li>
              <li><a href="#">One more separated link</a></li>
              </ul>
              </li> -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

<div class="page-header">
  <h1>Macros</h1>
</div>

<p><em></em></p>

<p><div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_special_variables">Special variables</a></li>
</ul>
</div>
<div class="paragraph">
<p>Clojure has a programmatic macro system which allows the compiler to be extended by user code. Macros can be used to define syntactic constructs which would require primitives or built-in support in other languages. Many core constructs of Clojure are not, in fact, primitives, but are normal macros.</p>
</div>
<div class="paragraph">
<p>Some macros produce simple combinations of primitive forms. For example, <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when"><code>when</code></a> combines <a href="special_forms#if"><code>if</code></a> and <a href="special_forms#do"><code>do</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure-repl" data-lang="clojure-repl">user=&gt; (macroexpand '(when (pos? a) (println "positive") (/ b a)))
(if (pos? a) (do (println "positive") (/ b a)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other macros re-arrange forms in useful ways, like the <code>-></code> macro, which recursively inserts each expression as the first argument of the next expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure-repl" data-lang="clojure-repl">user=&gt; (-&gt; {} (assoc :a 1) (assoc :b 2))
{:b 2, :a 1}
user=&gt; (macroexpand '(-&gt; {} (assoc :a 1) (assoc :b 2)))
(assoc (clojure.core/-&gt; {} (assoc :a 1)) :b 2)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_special_variables">Special variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Two special variables are available inside defmacro for more advanced usages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;form</code> - the actual form (as data) that is being invoked</p>
</li>
<li>
<p><code>&amp;env</code> - a map of local bindings at the point of macro expansion. The env map is from symbols to objects holding compiler information about that binding.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the following macros are documented on the <a href="https://clojure.github.io/clojure/">API</a> page. Many are also discussed on topic pages as noted:</p>
</div>
<div class="paragraph">
<p>Creating macros: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmacro">defmacro</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/definline">definline</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/macroexpand-1">macroexpand-1</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/macroexpand">macroexpand</a><br>
Branching: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/and">and</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/or">or</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when">when</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-not">when-not</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-let">when-let</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/when-first">when-first</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/if-not">if-not</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/if-let">if-let</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/cond">cond</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/condp">condp</a><br>
Looping (see also <a href="sequences">Sequences</a>): <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/for">for</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doseq">doseq</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/dotimes">dotimes</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/while">while</a><br>
Working with vars (see also <a href="vars">Vars and Environment</a>): <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/ns">ns</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/declare">declare</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defn">defn</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmacro">defmacro</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/definline">definline</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmethod">defmethod</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defmulti">defmulti</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defn-">defn-</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defonce">defonce</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/defstruct">defstruct</a><br>
Arranging code differently: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/%2E%2E">..</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doto">doto</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/-%3e">-></a><br>
Dynamic scopes (see also <a href="vars">Vars and Environment</a>): <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/binding">binding</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/locking">locking</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/time">time</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-in-str">with-in-str</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-local-vars">with-local-vars</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-open">with-open</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-out-str">with-out-str</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/with-precision">with-precision</a><br>
Creating lazy things (see also <a href="sequences">Sequences</a>): <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/lazy-cat">lazy-cat</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/lazy-cons">lazy-cons</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/delay">delay</a><br>
<a href="java_interop">Java interop</a> macros: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/%2E%2E">..</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/amap">amap</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/areduce">areduce</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/gen-class">gen-class</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/gen-interface">gen-interface</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/proxy">proxy</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/proxy-super">proxy-super</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/memfn">memfn</a><br>
Documenting code: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/assert">assert</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/comment">comment</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/doc">doc</a><br>
Transactions: <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/dosync">dosync</a> <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/io!">io!</a></p>
</div>
<div class="paragraph">
<p>A few <a href="special_forms">special forms</a> are actually implemented as macros, primarily to provide destructuring: fn let loop</p>
</div>
</div>
</div></p>

<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/prettify.js"></script>

  </body>
</html>