<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>Clojure - Transducers are Coming</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Clojure の日本語ドキュメントです">
    <meta name="author" content="Japan Clojurians">
    <meta name="keywords" content="Clojure 日本語">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../../../css/normalize.css" rel="stylesheet">
    <link href="../../../../css/webflow.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" type="image/x-icon" href="../../../../images/clojure-logo-icon-32.png">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../../">Clojure</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../../../about/rationale.html">概要</a></li>
            <li><a href="../../../../reference/documentation">リファレンス</a></li>
            <!-- <li><a href="../../../../api/api.html">API</a></li>
              <li><a href="../../../../community/downloads.html">リリース</a></li>
              <li><a href="../../../../guides/guides.html">ガイド</a></li>
              <li><a href="../../../../community/resources.html">コミュニティ</a></li>
              <li><a href="../../../../news/news.html">ニュース</a></li>
              <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Nav header</li>
              <li><a href="#">Separated link</a></li>
              <li><a href="#">One more separated link</a></li>
              </ul>
              </li> -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

<div class="page-header">
<h1>Transducers are Coming</h1>
</div>

<p><em></em></p>

<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Transducers are a powerful and composable way to build algorithmic transformations that you can reuse in many contexts, and they&#8217;re coming to Clojure core and core.async.</p>
</div>
<div class="paragraph">
<p>Two years ago, in a <a href="http://clojure.com/blog/2012/05/15/anatomy-of-reducer.html">blog post describing how reducers work</a>, I described the reducing function transformers on which they were based, and provided explicit examples like <code>mapping</code>, <code>filtering</code> and <code>mapcatting</code>. Because the reducers library intends to deliver an API with the same 'shape' as existing sequence function APIs, these transformers were never exposed a la carte, instead being encapsulated by the macrology of reducers.</p>
</div>
<div class="paragraph">
<p>In working recently on providing algorithmic combinators for core.async, I became more and more convinced of the superiority of reducing function transformers over channel&#8594;channel functions for algorithmic transformation. In fact, I think they are a better way to do many things for which we normally create bespoke replicas of map, filter etc.</p>
</div>
<div class="paragraph">
<p>So, reducing function transformers are getting a name - <strong>transducers</strong>, and first-class support in Clojure core and core.async.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_s_a_transducer">What&#8217;s a Transducer?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To recap that earlier post:</p>
</div>
<div class="paragraph">
<p>A reducing function is just the kind of function you&#8217;d pass to <code>reduce</code> - it takes a result so far and a new input and returns the next result-so-far. In the context of transducers it&#8217;s best to think about this most generally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>;;reducing function signature
whatever, input -&gt; whatever</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a transducer is a function that takes one reducing function and returns another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure" data-lang="clojure">;;transducer signature
(whatever, input -&gt; whatever) -&gt; (whatever, input -&gt; whatever)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The primary power of transducers comes from their fundamental decoupling - they don&#8217;t care (or know about):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the 'job' being done (what the reducing function does)</p>
</li>
<li>
<p>the context of use (what 'whatever' is)</p>
</li>
<li>
<p>the source of inputs (where input comes from).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other source of power comes from the fact that transducers compose using ordinary function composition.</p>
</div>
<div class="paragraph">
<p>The reducers library leverages transducers' decoupling from the job, the representation, and the source of inputs to accomplish parallel reduction. But transducers can also be used for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a la carte laziness</p>
</li>
<li>
<p>transformations during collection building</p>
</li>
<li>
<p>collection/iteration/laziness-free transforming reductions</p>
</li>
<li>
<p>channel transformations, event notifications and more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of this is coming to Clojure core and core.async.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_stuff">New stuff</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Concretely, most of the core sequence functions are gaining a new arity, one shorter than their current shortest, which elides the final collection source argument. This arity will return a transducer that represents the same logic, independent of lazy sequence processing.</p>
</div>
<div class="paragraph">
<p>Thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure" data-lang="clojure">;;look Ma, no collection!
(map f)</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns a 'mapping' transducer. filter et al get similar support.</p>
</div>
<div class="paragraph">
<p>You can build a 'stack' of transducers using ordinary function composition (comp):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure" data-lang="clojure">(def xform (comp (map inc) (filter even?)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might notice the similarity between the above comp and a call to &#8594;&gt;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-clojure" data-lang="clojure">(-&gt;&gt; aseq (map inc) (filter even?))</code></pre>
</div>
</div>
<div class="paragraph">
<p>One way to think of transducers is like &#8594;&gt; but independent of the job (lazy sequence creation) and the source of inputs (aseq).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transducers_in_action">Transducers in action</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve got a transducer, what can you do with it? <em><strong>An open set of things.</strong></em></p>
</div>
<div class="paragraph">
<p>For instance, given the above transducer and some data in a vector, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lazily transform the data (one lazy sequence, not three as with composed sequence functions)<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(sequence xform data)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>reduce with a transformation (no laziness, just a loop)<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(transduce xform + 0 data)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>build one collection from a transformation of another, again no laziness<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(into [] xform data)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>create a recipe for a transformation, which can be subsequently sequenced, iterated or reduced<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(iteration xform data)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>or use the same transducer to transform everything that goes through a channel<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>(chan 1 xform)</pre>
</div>
</div>
<div class="paragraph">
<p>The latter demonstrates the corresponding new capability of core.async channels - they can take transducers.</p>
</div>
<div class="paragraph">
<p>This post is just to serve as a heads up on what the ongoing work is about. There will be more explanations, tutorials and derivations to follow, here and elsewhere.</p>
</div>
<div class="paragraph">
<p>I&#8217;m excited about transducers and the power they bring, and I hope you are too!</p>
</div>
<div class="paragraph">
<p>Rich</p>
</div>
</div>
</div></p>

<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../js/jquery-1.11.1.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/prettify.js"></script>

  </body>
</html>